{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the PredictPro platform, authenticated via Firebase.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity, from Firebase Auth."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "oneXBetId": {
          "type": "string",
          "description": "User's 1xBet account ID."
        },
        "role": {
          "type": "string",
          "description": "User's role (User, Assistant, Admin, SuperAdmin).",
          "enum": [
            "User",
            "Assistant",
            "Admin",
            "SuperAdmin"
          ]
        },
        "isSuspended": {
          "type": "boolean",
          "description": "Indicates if the user account is suspended."
        }
      },
      "required": [
        "id",
        "email",
        "role"
      ]
    },
    "License": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "License",
      "type": "object",
      "description": "Represents a game license for a user, valid for a set number of rounds.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the License entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N License)"
        },
        "gameType": {
          "type": "string",
          "description": "Type of game the license is for (Crash, Aviator, Mines & Gems, VIP Slip).",
          "enum": [
            "Crash",
            "Aviator",
            "Mines & Gems",
            "VIP Slip"
          ]
        },
        "roundsRemaining": {
          "type": "number",
          "description": "Number of prediction rounds remaining for the license. Expires after 100 rounds.",
          "default": 100
        },
        "paymentVerified": {
          "type": "boolean",
          "description": "Indicates if the payment for this license has been verified by the webhook.",
          "default": false
        },
        "isActive": {
          "type": "boolean",
          "description": "Indicates if the license is active. A license is active if paymentVerified is true and roundsRemaining > 0."
        }
      },
      "required": [
        "id",
        "userId",
        "gameType"
      ]
    },
    "Prediction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Prediction",
      "type": "object",
      "description": "Represents a game prediction generated for a user for 1xBet.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Prediction entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Prediction)"
        },
        "licenseId": {
          "type": "string",
          "description": "Reference to License used for this prediction."
        },
        "gameType": {
          "type": "string",
          "description": "Type of game the prediction is for."
        },
        "predictionData": {
          "type": "string",
          "description": "JSON data containing the prediction details, formatted as a VIP Slip or game-specific data for 1xBet."
        },
        "disclaimer": {
          "type": "string",
          "description": "The required legal disclaimer for predictions."
        }
      },
      "required": [
        "id",
        "userId",
        "licenseId",
        "gameType",
        "predictionData"
      ]
    },
    "AuditLog": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AuditLog",
      "type": "object",
      "description": "Represents an audit log entry for security and monitoring.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the AuditLog entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User who performed the action. (Relationship: User 1:N AuditLog)"
        },
        "action": {
          "type": "string",
          "description": "Action performed (e.g., 'prediction_request', 'bypass_attempt', 'license_expired')."
        },
        "details": {
          "type": "string",
          "description": "JSON data containing the details of the action."
        },
        "ipAddress": {
          "type": "string",
          "description": "IP address of the user who performed the action."
        }
      },
      "required": [
        "id",
        "userId",
        "action"
      ]
    },
    "PaymentTransaction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "PaymentTransaction",
      "type": "object",
      "description": "Represents a payment transaction for a license.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Transaction entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Transaction)"
        },
        "licenseId": {
          "type": "string",
          "description": "The license being purchased."
        },
        "amount": {
          "type": "number",
          "description": "Amount of the transaction (e.g., 1500)."
        },
        "currency": {
          "type": "string",
          "description": "Currency of the transaction (KES)."
        },
        "paymentMethod": {
          "type": "string",
          "description": "Payment method used (Mpesa STK, Mpesa virtual card, Card, Till number)."
        },
        "status": {
          "type": "string",
          "description": "Status of the transaction (pending, verified, failed)."
        },
        "webhookVerified": {
          "type": "boolean",
          "description": "Set to true by Firebase webhook upon successful payment verification."
        }
      },
      "required": [
        "id",
        "userId",
        "licenseId",
        "amount",
        "currency",
        "paymentMethod",
        "status"
      ]
    }
  },
  "auth": {
    "providers": [
      "password"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Managed via Firebase, but profile data mirrored for app logic.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user from Firebase."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/licenses/{licenseId}",
        "definition": {
          "entityName": "License",
          "schema": {
            "$ref": "#/backend/entities/License"
          },
          "description": "Stores game licenses for a user. Each license expires after 100 prediction rounds and must have a verified payment.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            },
            {
              "name": "licenseId",
              "description": "Unique identifier for the license."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/predictions/{predictionId}",
        "definition": {
          "entityName": "Prediction",
          "schema": {
            "$ref": "#/backend/entities/Prediction"
          },
          "description": "Stores game predictions made by a user. Each prediction consumes one round from a license.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            },
            {
              "name": "predictionId",
              "description": "Unique identifier for the prediction."
            }
          ]
        }
      },
      {
        "path": "/transactions/{transactionId}",
        "definition": {
          "entityName": "PaymentTransaction",
          "schema": {
            "$ref": "#/backend/entities/PaymentTransaction"
          },
          "description": "Stores all payment transactions. Status is updated via Firebase webhook.",
          "params": [
            {
              "name": "transactionId",
              "description": "Unique identifier for the transaction."
            }
          ]
        }
      },
      {
        "path": "/auditlogs/{auditLogId}",
        "definition": {
          "entityName": "AuditLog",
          "schema": {
            "$ref": "#/backend/entities/AuditLog"
          },
          "description": "Global audit log for important system events, especially security-related ones.",
          "params": [
            {
              "name": "auditLogId",
              "description": "Unique identifier for the audit log entry."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is updated to align with the Master System Prompt. It defines user roles (User, Assistant, Admin, SuperAdmin) and sets the default to 'User' on registration. It maintains the core logic for Users, Licenses, Predictions, and Payments. User profiles are managed by Firebase Auth and user data is stored in Firestore. Licenses are tied to a user and expire based on 'roundsRemaining' and payment verification. Predictions are linked to both a user and a license. A top-level `transactions` collection tracks payments, with verification handled by a webhook. A global `auditlogs` collection is included for security monitoring."
  }
}