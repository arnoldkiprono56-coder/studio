
{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the PredictPro platform, authenticated via Firebase.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity, from Firebase Auth."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "oneXBetId": {
          "type": "string",
          "description": "User's 1xBet account ID."
        },
        "role": {
          "type": "string",
          "description": "User's role (User, Assistant, Admin, SuperAdmin).",
          "enum": [
            "User",
            "Assistant",
            "Admin",
            "SuperAdmin"
          ]
        },
        "isSuspended": {
          "type": "boolean",
          "description": "Indicates if the user account is suspended."
        },
        "referredBy": {
            "type": "string",
            "description": "The ID of the user who referred this user."
        },
        "balance": {
            "type": "number",
            "description": "The user's wallet balance from commissions.",
            "default": 0
        },
        "assistantAgreementAccepted": {
            "type": "boolean",
            "description": "Indicates if the assistant has accepted the onboarding agreement.",
            "default": false
        },
        "assistantPaymentNumber": {
          "type": "string",
          "description": "The payment number provided by an assistant during onboarding."
        },
        "companyAgreementAccepted": {
            "type": "boolean",
            "description": "Indicates if the user has accepted the general company agreement.",
            "default": false
        }
      },
      "required": [
        "id",
        "email",
        "role"
      ]
    },
    "License": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "License",
      "type": "object",
      "description": "Represents a game license for a user, valid for a set number of rounds.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the License entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N License)"
        },
        "gameType": {
          "type": "string",
          "description": "Type of game the license is for (Crash, Aviator, Mines & Gems, VIP Slip).",
          "enum": [
            "Crash",
            "Aviator",
            "Mines & Gems",
            "VIP Slip"
          ]
        },
        "roundsRemaining": {
          "type": "number",
          "description": "Number of prediction rounds remaining for the license. Expires after 100 rounds.",
          "default": 100
        },
        "paymentVerified": {
          "type": "boolean",
          "description": "Indicates if the payment for this license has been verified by the webhook.",
          "default": false
        },
        "isActive": {
          "type": "boolean",
          "description": "Indicates if the license is active. A license is active if paymentVerified is true and roundsRemaining > 0."
        }
      },
      "required": [
        "id",
        "userId",
        "gameType"
      ]
    },
    "Prediction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Prediction",
      "type": "object",
      "description": "Represents a game prediction generated for a user for 1xBet.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Prediction entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Prediction)"
        },
        "licenseId": {
          "type": "string",
          "description": "Reference to License used for this prediction."
        },
        "gameType": {
          "type": "string",
          "description": "Type of game the prediction is for."
        },
        "predictionData": {
          "type": "object",
          "description": "JSON data containing the prediction details, formatted as a VIP Slip or game-specific data for 1xBet."
        },
        "disclaimer": {
          "type": "string",
          "description": "The required legal disclaimer for predictions."
        },
        "status": {
          "type": "string",
          "description": "The outcome of the prediction.",
          "enum": ["pending", "won", "lost"]
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp of when the prediction was created."
        }
      },
      "required": [
        "id",
        "userId",
        "licenseId",
        "gameType",
        "predictionData",
        "status",
        "timestamp"
      ]
    },
    "AuditLog": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AuditLog",
      "type": "object",
      "description": "Represents an audit log entry for security and monitoring.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the AuditLog entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User who performed the action. (Relationship: User 1:N AuditLog)"
        },
        "action": {
          "type": "string",
          "description": "Action performed (e.g., 'prediction_request', 'bypass_attempt', 'license_expired')."
        },
        "details": {
          "type": "string",
          "description": "JSON data containing the details of the action."
        },
        "ipAddress": {
          "type": "string",
          "description": "IP address of the user who performed the action."
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp of when the action occurred."
        }
      },
      "required": [
        "id",
        "userId",
        "action",
        "timestamp"
      ]
    },
    "PaymentTransaction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "PaymentTransaction",
      "type": "object",
      "description": "Represents a payment transaction for a license or a commission.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Transaction entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Transaction)"
        },
        "licenseId": {
          "type": "string",
          "description": "The license being purchased (if applicable)."
        },
        "type": {
          "type": "string",
          "description": "The type of transaction (purchase, commission, withdrawal, reward).",
          "enum": ["purchase", "commission", "withdrawal", "reward"]
        },
        "description": {
          "type": "string",
          "description": "A brief description of the transaction (e.g., 'Commission from user@test.com')."
        },
        "amount": {
          "type": "number",
          "description": "Amount of the transaction (e.g., 1500 for purchase, -300 for withdrawal)."
        },
        "currency": {
          "type": "string",
          "description": "Currency of the transaction (KES)."
        },
        "paymentMethod": {
          "type": "string",
          "description": "Payment method used (Mpesa STK, Mpesa virtual card, Card, Till number)."
        },
        "status": {
          "type": "string",
          "description": "Status of the transaction (pending, verified, failed, completed)."
        },
        "webhookVerified": {
          "type": "boolean",
          "description": "Set to true by Firebase webhook upon successful payment verification."
        }
      },
      "required": [
        "id",
        "userId",
        "amount",
        "currency",
        "status",
        "type",
        "description"
      ]
    },
    "Plan": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Plan",
      "type": "object",
      "description": "Defines a pricing plan for a game license.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique ID for the plan (e.g., 'vip-slip')."
        },
        "name": {
          "type": "string",
          "description": "Display name of the plan (e.g., 'VIP Slip')."
        },
        "price": {
          "type": "number",
          "description": "The cost of the plan."
        },
        "currency": {
          "type": "string",
          "description": "The currency of the price (e.g., 'KES').",
          "default": "KES"
        },
        "rounds": {
          "type": "number",
          "description": "The number of rounds included in the plan.",
          "default": 100
        }
      },
      "required": [
        "id",
        "name",
        "price",
        "rounds"
      ]
    },
    "Prompt": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Prompt",
      "type": "object",
      "description": "Represents an editable AI prompt template for Genkit flows.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the prompt (e.g., 'generateVipSlipPrompt')."
        },
        "name": {
          "type": "string",
          "description": "A user-friendly name for the prompt."
        },
        "content": {
          "type": "string",
          "description": "The full text content of the prompt template."
        },
        "lastModified": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp of when the prompt was last updated."
        },
        "version": {
          "type": "number",
          "description": "A version number for tracking changes."
        }
      },
      "required": [
        "id",
        "name",
        "content"
      ]
    },
    "GameStatus": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "GameStatus",
      "type": "object",
      "description": "Stores the operational status of a game.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique ID for the game (e.g., 'aviator')."
        },
        "name": {
          "type": "string",
          "description": "Display name of the game (e.g., 'Aviator')."
        },
        "isEnabled": {
          "type": "boolean",
          "description": "Whether the game is currently enabled for users.",
          "default": true
        },
        "disabledReason": {
          "type": "string",
          "description": "The reason displayed to users if the game is disabled."
        }
      },
      "required": ["id", "name", "isEnabled"]
    },
    "Notification": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Notification",
      "type": "object",
      "description": "A global notification or broadcast message for users.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique ID for the notification."
        },
        "message": {
          "type": "string",
          "description": "The content of the broadcast message (supports Markdown)."
        },
        "targetAudience": {
          "type": "string",
          "description": "The target audience for the notification.",
          "enum": ["all", "premium", "staff", "user"]
        },
        "userId": {
          "type": "string",
          "description": "The ID of the user this notification is for, if it's not a broadcast."
        },
        "senderId": {
          "type": "string",
          "description": "The ID of the admin who sent the message."
        },
        "senderEmail": {
          "type": "string",
          "description": "The email of the admin who sent the message."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp of when the notification was created."
        }
      },
      "required": ["id", "message", "targetAudience", "createdAt"]
    }
  },
  "auth": {
    "providers": [
      "password"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Managed via Firebase, but profile data mirrored for app logic.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user from Firebase."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/user_licenses/{licenseId}",
        "definition": {
          "entityName": "License",
          "schema": {
            "$ref": "#/backend/entities/License"
          },
          "description": "Stores game licenses for a user. Each license expires after 100 prediction rounds and must have a verified payment.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            },
            {
              "name": "licenseId",
              "description": "Unique identifier for the license."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/predictions/{predictionId}",
        "definition": {
          "entityName": "Prediction",
          "schema": {
            "$ref": "#/backend/entities/Prediction"
          },
          "description": "Stores game predictions made by a user. Each prediction consumes one round from a license.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            },
            {
              "name": "predictionId",
              "description": "Unique identifier for the prediction."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/transactions/{transactionId}",
        "definition": {
          "entityName": "PaymentTransaction",
          "schema": {
            "$ref": "#/backend/entities/PaymentTransaction"
          },
          "description": "Stores all payment transactions for a specific user.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            },
            {
              "name": "transactionId",
              "description": "Unique identifier for the transaction."
            }
          ]
        }
      },
      {
        "path": "/auditlogs/{auditLogId}",
        "definition": {
          "entityName": "AuditLog",
          "schema": {
            "$ref": "#/backend/entities/AuditLog"
          },
          "description": "Global audit log for important system events, especially security-related ones.",
          "params": [
            {
              "name": "auditLogId",
              "description": "Unique identifier for the audit log entry."
            }
          ]
        }
      },
      {
        "path": "/plans/{planId}",
        "definition": {
          "entityName": "Plan",
          "schema": {
            "$ref": "#/backend/entities/Plan"
          },
          "description": "Stores the pricing and configuration for each game license plan.",
          "params": [
            {
              "name": "planId",
              "description": "Unique identifier for the plan (e.g. 'vip-slip')."
            }
          ]
        }
      },
      {
        "path": "/prompts/{promptId}",
        "definition": {
          "entityName": "Prompt",
          "schema": {
            "$ref": "#/backend/entities/Prompt"
          },
          "description": "Stores editable AI prompt templates for Genkit flows. Only admins can edit.",
          "params": [
            {
              "name": "promptId",
              "description": "Unique identifier for the prompt (e.g. 'generateVipSlipPrompt')."
            }
          ]
        }
      },
      {
        "path": "/game_status/{gameId}",
        "definition": {
          "entityName": "GameStatus",
          "schema": {
            "$ref": "#/backend/entities/GameStatus"
          },
          "description": "Stores the operational status of each game (e.g., enabled, disabled).",
          "params": [
            {
              "name": "gameId",
              "description": "The unique identifier for the game (e.g., 'aviator')."
            }
          ]
        }
      },
       {
        "path": "/notifications/{notificationId}",
        "definition": {
          "entityName": "Notification",
          "schema": {
            "$ref": "#/backend/entities/Notification"
          },
          "description": "Stores global broadcast messages for users.",
          "params": [
            {
              "name": "notificationId",
              "description": "The unique identifier for the notification."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is updated to align with the Master System Prompt. It defines user roles (User, Assistant, Admin, SuperAdmin) and sets the default to 'User' on registration. It maintains the core logic for Users, Licenses, Predictions, and Payments. User profiles are managed by Firebase Auth and user data is stored in Firestore. Licenses are tied to a user and expire based on 'roundsRemaining' and payment verification. Predictions are linked to both a user and a license. Transactions are now a subcollection of a user for improved security and querying. A global `auditlogs` collection is included for security monitoring. A `plans` collection is added to store pricing information. A new `prompts` collection is added to store editable AI prompts, manageable by admins."
  }
}

    